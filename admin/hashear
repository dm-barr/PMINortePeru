<?php
// hashear_passwords.php
require_once __DIR__ . '/config/Database.php';

$db = new Database();
$conn = $db->getConnection();

// Obtener todos los usuarios
$stmt = $conn->query("SELECT id_Usuario, contrasena FROM Usuario");
$usuarios = $stmt->fetchAll(PDO::FETCH_ASSOC);

foreach ($usuarios as $usuario) {
    // Solo hashear si la contraseña no está hasheada (menos de 60 caracteres)
    if (strlen($usuario['contrasena']) < 60) {
        $password_hasheada = password_hash($usuario['contrasena'], PASSWORD_DEFAULT);
        
        $update = $conn->prepare("UPDATE Usuario SET contrasena = ? WHERE id_Usuario = ?");
        $update->execute([$password_hasheada, $usuario['id_Usuario']]);
        
        echo "Usuario ID {$usuario['id_Usuario']}: contraseña actualizada<br>";
    }
}

echo "<br>Proceso completado. Todas las contraseñas están hasheadas.";
?>
